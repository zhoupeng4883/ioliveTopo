<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>DesignHelper.as</title>
<link rel="stylesheet" type="text/css" href="../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">designs</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">iolive</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">topology</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">canvas</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">IGraph</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">iolive</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">topology</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GraphDragDropEvent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">iolive</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">topology</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GraphNodeEvent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">iolive</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">topology</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SelectedNodesChangedEvent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">iolive</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">topology</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">DefaultGraphItem</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">iolive</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">topology</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GroupedNode</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">iolive</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">topology</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">IGraphNode</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">iolive</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">topology</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ui</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">alert</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">AlertTitle</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">iolive</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">topology</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GraphicsUtils</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">KeyboardEvent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MouseEvent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geom</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Point</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ui</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Keyboard</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">controls</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Menu</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">UIComponent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MenuEvent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">managers</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">CursorManager</span>;

    <span class="ActionScriptASDoc">/**
     * 设计器处理逻辑类
     */</span> 
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">DesignHelper</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Bindable</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_graph</span>:<span class="ActionScriptDefault_Text">IGraph</span>;
        <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Bindable</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_model</span>:<span class="ActionScriptDefault_Text">DesignGraphModel</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">menu</span>:<span class="ActionScriptDefault_Text">Menu</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">draging</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">startNode</span>:<span class="ActionScriptDefault_Text">IGraphNode</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">endNode</span>:<span class="ActionScriptDefault_Text">IGraphNode</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_lineStyle</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">{</span><span class="ActionScriptDefault_Text">color</span>:0x8EA3BE<span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">alpha</span>:1<span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">thickness</span>:1<span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">dashed</span>:<span class="ActionScriptReserved">false</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">dashLength</span>:10<span class="ActionScriptBracket/Brace">}</span>;
        <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Embed</span><span class="ActionScriptBracket/Brace">(</span>=<span class="ActionScriptString">'assets/topo/mou.png'</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">drawCursor</span>:<span class="ActionScriptDefault_Text">Class</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cursorId</span>:<span class="ActionScriptDefault_Text">uint</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nodeRightMenu</span>:<span class="ActionScriptDefault_Text">Menu</span>;
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">model</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_value</span>:<span class="ActionScriptDefault_Text">DesignGraphModel</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_model</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_value</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">model</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">DesignGraphModel</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_model</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">IGraph</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_graph</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_lineStyle</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_lineStyle</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_value</span>:<span class="ActionScriptDefault_Text">IGraph</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_graph</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_value</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_graph</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">GraphDragDropEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">graphDragDrop</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">dropHanlder</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">GraphNodeEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">NODE_MOUSE_OVER</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">nodeMouseOverHanlder</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SelectedNodesChangedEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SELECTED_NODES_CHANGED</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">selectedChanger</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">DesignEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">markerMouseClick</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">markerClickHanlder</span><span class="ActionScriptBracket/Brace">)</span>;<span class="ActionScriptComment">//在某个节点渲染器上的Marker上点击触发开始连线
</span>                <span class="ActionScriptDefault_Text">_graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">GraphNodeEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">NODE_CLICK</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">nodeClickHanlder</span><span class="ActionScriptBracket/Brace">)</span>;<span class="ActionScriptComment">//在其他节点上点击时触发结束连线操作
</span>                <span class="ActionScriptDefault_Text">_graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MOUSE_MOVE</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">graphMoveHanlder</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">KeyboardEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">KEY_DOWN</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">keyDownHanlder</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">GraphNodeEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">NODE_RIGHT_CLICK</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">nodeRightClickHanlder</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_graph</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">UIComponent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">doubleClickEnabled</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptDefault_Text">_graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">DOUBLE_CLICK</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">graphDoubleClickHanlder</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * 画布接收到拖拽对象时
         */</span> 
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">dropHanlder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">drop</span>:<span class="ActionScriptDefault_Text">GraphDragDropEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_model</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addDesignModel</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">drop</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">type</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">drop</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">name</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nodesLayer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mouseX</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nodesLayer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mouseY</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">drop</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * 选择的节点发生变化时，此事件由画布抛出
         */</span> 
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">selectedChanger</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">SelectedNodesChangedEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">selectedNode</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">GroupedNode</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptDefault_Text">clearAllMarker</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">selNode</span>:<span class="ActionScriptDefault_Text">IGraphNode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">selectedNode</span>;
            <span class="ActionScriptDefault_Text">despatchSelectEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">selNode</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * 清除Marker状态
         */</span> 
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">clearAllMarker</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">renderer</span>:<span class="ActionScriptDefault_Text">CompositeRenderer</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nodes</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">model</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nodes</span>;
            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">size</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">nodes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">size</span>; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">renderer</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nodeToUI</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nodes</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">CompositeRenderer</span>;
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">renderer</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptDefault_Text">renderer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span>
                    <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">DesignEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">DesignEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nodeUnSelected</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">nodes</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">renderer</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * 鼠标移入节点时显示Marker
         */</span> 
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">nodeMouseOverHanlder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">GraphNodeEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">selectedNode</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">GroupedNode</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptDefault_Text">clearAllMarker</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">despatchSelectEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">node</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * 抛出事件，通知渲染器显示Marker
         */</span> 
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">despatchSelectEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">node</span>:<span class="ActionScriptDefault_Text">IGraphNode</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">node</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">GroupedNode</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">renderer</span>:<span class="ActionScriptDefault_Text">CompositeRenderer</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nodeToUI</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">node</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">CompositeRenderer</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">renderer</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptDefault_Text">renderer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span>
                <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">DesignEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">DesignEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nodeSelected</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">node</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">renderer</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * 在几点上悬浮时,出现一个菜单选项，用于连接两个节点
         */</span> 
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">nodeClickHanlder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">GraphNodeEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">draging</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">endNode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">node</span>;
                <span class="ActionScriptDefault_Text">joinComplete</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * 渲染器鼠标移入的监听
         */</span> 
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">markerClickHanlder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">DesignEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">draging</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptDefault_Text">startNode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">node</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">CursorManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">currentCursorID</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">CursorManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">NO_CURSOR</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">cursorId</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">CursorManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setCursor</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">drawCursor</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * 连接完成
         */</span> 
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">joinComplete</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">model</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addDesignArc</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">startNode</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">endNode</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">startNode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptDefault_Text">endNode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptDefault_Text">draging</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">drawGraphc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">clear</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">CursorManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeCursor</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">CursorManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">currentCursorID</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">cursorId</span> <span class="ActionScriptOperator">=</span> 0;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * 在画布上移动鼠标时
         */</span> 
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">graphMoveHanlder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">draging</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">drawGraphc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">clear</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">drawGraphc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">thickness</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">color</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">alpha</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">startPoint</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">startNode</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">centerX</span><span class="ActionScriptOperator">,</span>
                    <span class="ActionScriptDefault_Text">startNode</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">centerY</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">endPoint</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nodesLayer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mouseX</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nodesLayer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mouseY</span><span class="ActionScriptBracket/Brace">)</span>;

                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">arcType</span> <span class="ActionScriptOperator">==</span><span class="ActionScriptDefault_Text">DefaultGraphItem</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">LINE_TYPE_STRAIGHT</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">GraphicsUtils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">drawLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">drawGraphc</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">startPoint</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">endPoint</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dashed</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dashLength</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">arcType</span> <span class="ActionScriptOperator">==</span><span class="ActionScriptDefault_Text">DefaultGraphItem</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">LINE_TYPE_BROKEN_1</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">GraphicsUtils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">drawBrokenLineP1</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">drawGraphc</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">startPoint</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">endPoint</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dashed</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dashLength</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">arcType</span> <span class="ActionScriptOperator">==</span><span class="ActionScriptDefault_Text">DefaultGraphItem</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">LINE_TYPE_BROKEN_2</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">GraphicsUtils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">drawBrokenLineP2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">drawGraphc</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">startPoint</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">endPoint</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dashed</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dashLength</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">arcType</span> <span class="ActionScriptOperator">==</span><span class="ActionScriptDefault_Text">DefaultGraphItem</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">LINE_TYPE_CIRCULAR</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">GraphicsUtils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">drawCircular</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">drawGraphc</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">startPoint</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">endPoint</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dashed</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dashLength</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">arcType</span> <span class="ActionScriptOperator">==</span><span class="ActionScriptDefault_Text">DefaultGraphItem</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">LINE_TYPE_DIRECTEDBALLOON</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">GraphicsUtils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">drawDirectedBalloonEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">drawGraphc</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">startPoint</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">endPoint</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dashed</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dashLength</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span><span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">GraphicsUtils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">drawLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">drawGraphc</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">startPoint</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">endPoint</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dashed</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dashLength</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * 双击取消操作
         */</span> 
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">graphDoubleClickHanlder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">draging</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">drawGraphc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">clear</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">CursorManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeCursor</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">CursorManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">currentCursorID</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">cursorId</span> <span class="ActionScriptOperator">=</span> 0;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * 键盘监听
         */</span> 
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">keyDownHanlder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">KeyboardEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">selectedNoes</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">selectedNodes</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">keyCode</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">Keyboard</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">DELETE</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">model</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeNodes</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">selectedNoes</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">AlertTitle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">showTip</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"删除了"</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">selectedNoes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">"个节点"</span><span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">AlertTitle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">success</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * 在节点右键点击时触发
         */</span> 
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">nodeRightClickHanlder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">GraphNodeEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nodeRightMenu</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">nodeRightMenu</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">hide</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">nodeRightMenu</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MenuEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ITEM_CLICK</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">menuItemClickHanlder</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">nodeRightMenu</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">nodeRightMenu</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Menu</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">createMenu</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nodeToUI</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">node</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptBracket/Brace">{</span><span class="ActionScriptDefault_Text">label</span>:<span class="ActionScriptString">"隐藏"</span><span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptOperator">,</span><span class="ActionScriptBracket/Brace">{</span><span class="ActionScriptDefault_Text">label</span>:<span class="ActionScriptString">"删除"</span><span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptOperator">,</span><span class="ActionScriptBracket/Brace">{</span><span class="ActionScriptDefault_Text">label</span>:<span class="ActionScriptString">"重命名"</span><span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">nodeRightMenu</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MenuEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ITEM_CLICK</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">menuItemClickHanlder</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nodesLayer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">localToGlobal</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nodesLayer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mouseX</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nodesLayer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mouseY</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">nodeRightMenu</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">show</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">menuItemClickHanlder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ev</span>:<span class="ActionScriptDefault_Text">MenuEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ev</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">item</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">label</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">"隐藏"</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">filterManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">hiddenItemsFilter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">hideNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">node</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ev</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">item</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">label</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">"删除"</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">node</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ev</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">item</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">label</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">"重命名"</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">renameNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">node</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span></pre></body>
</html>
